<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <script>
        function Login() {
            const emailAddress = document.getElementById("email").value;

            const payload = {
                "operationName": null,
                "variables": {},
                "query": "mutation { login(appId: \"1\", emailAddress: \"" + emailAddress + "\") { success errorMessage }}"
            };

            const xhr = new XMLHttpRequest();
            xhr.withCredentials = true;
            xhr.open("POST", "http://omo.local:8080/auth");
            xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
            xhr.send(JSON.stringify(payload));
            xhr.onreadystatechange = (e) => {
                document.getElementById("request").style.visibility = "hidden";
                document.getElementById("response").style.visibility = "visible";
            }
        }
        function ExchangeTokenForCookie() {
            const payload = {
                "operationName": null,
                "variables": {},
                "query": "mutation { exchangeToken(jwt:\"\") { success errorMessage }}"
            };
            const xhr = new XMLHttpRequest();
            xhr.withCredentials = true;
            xhr.open("POST", "http://omo.local:8080/keyStore");
            xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
            xhr.send(JSON.stringify(payload));
            xhr.onreadystatechange = (e) => {
                alert("sent");
            }
        }
    </script>
</head>
<body>
<div style="width: 100%; height:100%;">
    <div id="request" style="width: 200px; height: 150px; margin: 0 auto">
        <h1>OMO Login</h1>
        <p>Please provide your E-Mail address below:</p>
        <input id="email" type="text"><br/>
        <input type="button" onclick="Login()" value="Send magic link">
        <input type="button" onclick="ExchangeTokenForCookie()" value="Get cookie">
    </div>
    <div id="response" style="width: 200px; height: 150px; margin: 0 auto; visibility: hidden;">
        <h1>Thank you!</h1>
        <p>Please take a look at your inbox. Your magic login link should arrive shortly.</p>
    </div>
</div>
</body>
</html>
