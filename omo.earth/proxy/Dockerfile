FROM nginx:latest

ARG PROXY_PROTOCOL
ARG PROXY_DOMAIN
ARG PROXY_PORT
ARG PROXY_EXTERN_DOMAIN
ARG PROXY_EXTERN_PORT
ARG PROXY_SERVICE_AUTH_PATH
ARG PROXY_SERVICE_IDENTITY_PATH
ARG AUTH_PROTOCOL
ARG AUTH_DOMAIN
ARG AUTH_PORT
ARG IDENTITY_PROTOCOL
ARG IDENTITY_DOMAIN
ARG IDENTITY_PORT

ENV PROXY_PROTOCOL="$PROXY_PROTOCOL"
ENV PROXY_DOMAIN="$PROXY_DOMAIN"
ENV PROXY_PORT="$PROXY_PORT"
ENV PROXY_EXTERN_DOMAIN="$PROXY_EXTERN_DOMAIN"
ENV PROXY_EXTERN_PORT="$PROXY_EXTERN_PORT"
ENV PROXY_SERVICE_AUTH_PATH="$PROXY_SERVICE_AUTH_PATH"
ENV PROXY_SERVICE_IDENTITY_PATH="$PROXY_SERVICE_IDENTITY_PATH"
ENV AUTH_PROTOCOL="$AUTH_PROTOCOL"
ENV AUTH_DOMAIN="$AUTH_DOMAIN"
ENV AUTH_PORT="$AUTH_PORT"
ENV IDENTITY_PROTOCOL="$IDENTITY_PROTOCOL"
ENV IDENTITY_DOMAIN="$IDENTITY_DOMAIN"
ENV IDENTITY_PORT="$IDENTITY_PORT"

COPY default.sh /etc/nginx/conf.d/default.sh

#RUN ls -a /etc/letsencrypt/live/alpha.omo.earth

RUN chmod +x /etc/nginx/conf.d/default.sh
RUN cd /etc/nginx/conf.d/ && /etc/nginx/conf.d/default.sh
RUN cat /etc/nginx/conf.d/default.conf
RUN rm -f /etc/nginx/conf.d/default.sh
